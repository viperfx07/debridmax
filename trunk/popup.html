<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>DebridMax Chrome Extension: Popup</title>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="const.js"></script>
	<script type="text/javascript">
	//<![CDATA[
	var myWindow;
	//Get backgroundpage
	bg = chrome.extension.getBackgroundPage();

	function openSubWindow() {
		bg.openNewWindow("submissionWindow.html");
	}
	
	//Open login page in new tab
	function openLoginForm(host) {
		$.get(DM_ROOT + "index.php?lang=en",function(){
			chrome.tabs.create({url:host});
		});
		
	}

	//Set login, credit, and server load html;
	function setDetails(isLoggedIn) {
	
	if(isLoggedIn)
	{
		$("#user").text("Welcome, " + bg.login_details.user);
		$("#type").text("Account Type: " + bg.login_details.type);
		$("#point").text("Reward Point(s): " + bg.login_details.point.replace(/&nbsp;/g,''));
		if(bg.login_details.premium != '')
				$("#premium").text("Premium: " + bg.login_details.premium);
		$(".login_details").show();
	}
	else
	{
		$("#dm_details").html(bg.login_details.user);
	}
		/* Server stats */
		/*
		$("#premium_account_stats").load("http://www.debridmax.com div#useful-links table",function(){ 
			//replace dt.host_p css's background-url with DM_ROOT instead of the extension's URL
			$("dt.host_p").each(function(){
				$(this).css("background",$(this).css("background").replace("chrome-extension://opoiifdgfgecnammngihaedbgcajohbl/",DM_ROOT));
			});
		});
		*/
	}

	$(document).ready(function(){
	   
		//Initiate refresh button for login/server details
		var notloggedin_text = chrome.i18n.getMessage("background_notloggedin") + '(<a href=javascript:openLoginForm("' + DM_ROOT + "login.php" + '")>'+chrome.i18n.getMessage("background_login_link")+'</a>).';
		$("img#loader").attr('src', chrome.extension.getURL('/load.gif'));
		
		bg.init(function(isLoggedIn){
			$(".login_details").hide();
			if(isLoggedIn)
				$("#subWindow").show();
			else
				$("#subWindow").hide();
			
			//Write login, credit, and server load;
			setDetails(isLoggedIn);
			
			//Add root server url prior to the img src 
			$("img").each(function(){
				$(this).attr({src:DM_ROOT + $(this).attr('src')});
			});
			
			$("#subWindow").text(chrome.i18n.getMessage("popup_downloader_text"));
			$(".loader").hide();
		});
	});
	//]]>
	</script>

	<style type="text/css">
	body {
		background: #000;
		margin: 0;
		padding: 0;
		font: 12px normal "Trebuchet MS", Arial, Helvetica, sans-serif;
		color: #fff;
		min-width:100px;
		overflow-x:hidden;
	}

	.container {width: 200px; margin: 10px;}
	
	a {
	color : #ff0000;
	}
	a:hover {
	text-decoration : none;
	}
	
	</style>
</head>

<body>
	<div class="loader">
		<img id="loader" alt="loader" /> Loading your login details... 
	</div>
	<div class="container">
		<div id="logindetails" style="display:inline;">
			<div id="dm_details">
				<p class="login_details" id="user"></p>
				<p class="login_details" id="type"></p>
				<p class="login_details" id="point"></p>
				<p class="login_details" id="premium"></p>
			</div>
			<a href="javascript:openSubWindow();" id="subWindow"></a>
		</div>
	</div>
</body>
</html>